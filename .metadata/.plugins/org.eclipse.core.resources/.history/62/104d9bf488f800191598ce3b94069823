package com.ccee.projetotestejava.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.ccee.projetotestejava.exception.DaoException;
import com.ccee.projetotestejava.factory.ConnectionDataFactory;
import com.ccee.projetotestejava.model.Descontos;

/**
 * Classe Dao responsável pelos acessos a tabela 'descontos'
 * 
 * @author bruno.minozzi
 * @since 26/10/2019
 *
 */
public class DescontosDao {

    private Connection connection;

    public DescontosDao() {
        this.connection = new ConnectionDataFactory().getConnection();
    }
    
    /**
     * Método responsável por retornar lista de Objeto 'Descontos'
     * @return List<Descontos>
     * @throws DescontosDaoException 
     */
    public List<Descontos> getListaDescontos() throws DaoException {
    	List<Descontos> listaDescontos = new ArrayList<Descontos>();
        try {
            PreparedStatement stmt = this.connection.
                    prepareStatement("select * from descontos");
            ResultSet rs = stmt.executeQuery();

            while (rs.next()) {
            	Descontos descontos = new Descontos();
            	descontos.setIdDesconto(rs.getInt("id_desconto"));
            	descontos.setIdFuncionario(rs.getInt("id_funcionario"));
            	descontos.setValorDesconto(rs.getBigDecimal("vl_desconto"));

            	listaDescontos.add(descontos);
            }
            rs.close();
            stmt.close();
        } catch (SQLException e) {
        	throw new RuntimeException(e.getMessage(), e.getCause());
        }finally{
        	this.closeConnection();
        }
        return listaDescontos;
    }
    
    /**
     * Método responsável por fechar a conexão com Banco
     * @throws FuncionarioDaoException
     */
	private void closeConnection() throws DaoException {
		if (this.connection != null) {
			try {
				this.connection.close();
			} catch (SQLException e) {
				throw new DaoException(e.getMessage(), e.getCause());
			}
		}
	}
}
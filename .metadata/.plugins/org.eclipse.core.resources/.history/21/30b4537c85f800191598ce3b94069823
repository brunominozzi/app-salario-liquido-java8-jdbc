package com.ccee.projetotestejava.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.ccee.projetotestejava.exception.FuncionarioDaoException;
import com.ccee.projetotestejava.factory.ConnectionDataFactory;
import com.ccee.projetotestejava.model.Funcionario;

/**
 * Classe Dao responsável pelos acessos a tabela 'funcionario'
 * 
 * @author bruno.minozzi
 * @since 26/10/2019
 *
 */
public class FuncionarioDao {

    private Connection connection;

    public FuncionarioDao() {
        this.connection = new ConnectionDataFactory().getConnection();
    }
    
    /**
     * Método responsável por retornar lista de Objeto 'Descontos'
     * @return List<Descontos>
     */
    public List<Funcionario> getListaFuncionarios() {
        try {
            List<Funcionario> funcionarios = new ArrayList<Funcionario>();
            PreparedStatement stmt = this.connection.
                    prepareStatement("select * from funcionario");
            ResultSet rs = stmt.executeQuery();

            while (rs.next()) {
            	Funcionario funcionario = new Funcionario();
            	funcionario.setIdFuncionario(rs.getInt("id_funcionario"));
            	funcionario.setNomeCliente(rs.getString("nm_cliente"));
            	funcionario.setValorSalarioBruto(rs.getBigDecimal("nm_cliente"));

            	funcionarios.add(funcionario);
            }
            rs.close();
            stmt.close();
            return funcionarios;
        } catch (SQLException e) {
        	throw new RuntimeException(e.getMessage(), e.getCause());
        }finally{
        	this.closeConnection();
        }
    }
    
    private void closeConnection() {
    	  if (this.connection != null) {
    	    try {
    	    	this.connection.close();
    	    } catch (SQLException e) {
    	    	throw new FuncionarioDaoException(e.getMessage(), e.getCause());
    	    }
    	  }
    	}
}